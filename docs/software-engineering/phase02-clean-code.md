---
title: Clean Code
description: ''
---


> You spend much more time reading code than writing code.

> It is not enough for code to work!

## مقدمه

آیا تا به حال فکر کرده‌اید که چند درصد وقت خود را مشغول **نوشتن**، و چند درصد آن را مشغول **خواندن** کد هستید؟ شاید تا به حال در توسعه پروژه‌های کوچک چند‌هزارخطی، اغلب وقت شما به نوشتن کد صرف شده باشد، اما واقعیت آن است که در پروژه‌های صنعتی و بزرگ، بیشتر وقت شما صرف خواندن و مطالعه کد خواهد شد! همین موضوع نشان می‌دهد که خوانایی و تمیز بودن کد از اهمیت بالایی برخوردار است. 

در این فاز قرار است با مفاهیم و تکنیک‌های افزایش کیفیت کد آشنا شویم و پروژه فاز قبل را به یک کد بسیار با کیفیت تبدیل کنیم. در نهایت نیز کد خود را با سایر کارآموزان به اشتراک می‌گذاریم و کد آن‌ها را Review خواهیم کرد.

:::caution ‌
قبل از شروع اما یک برنچ جدید برای این منظور ایجاد کنید تا تمیز‌سازی را در آن انجام دهیم.
:::

## اهمیت Clean Code

در ابتدا در مورد دو سوال زیر فکر کنید و با هم‌تیمی خود بحث کنید و پاسخ خود را در ایشو بنویسید:

1. چرا تمیز بودن کد و داشتن معماری خوب مهم است؟ چرا باید وقت و انرژی زیادی صرف طراحی و نوشتن کد تمیز شود؟
1. چرا این موضوع در ابعاد صنعتی اهمیت بسیار بیشتری پیدا می‌کند؟

:::note ‌
تلاش کنید **فقط با فکر خودتان و بحث با هم‌تیمی** به جواب سوالات بالا برسید تا ذهن شما برای مراحل بعد آماده شود.
:::

:::caution ‌
لطفا قبل از فکر کردن به این سوالات به سراغ مراحل بعدی و خواندن مقالات نروید!
:::

حال برای فهم دلایل اهمیت کد تمیز در صنعت، [The Importance of Clean Code](https://www.arcanys.com/blog/the-importance-of-clean-code)
را در جواب سوال اول و [Why software maintainability is crucial - TechHQ](https://techhq.com/2019/06/why-software-maintainability-is-crucial/)
را در جواب سوال دوم مطالعه کنید.

## Code Smell

یکی از راه‌های افزایش کیفیت کد، پیدا کردن نشانه‌های کد کثیف در برنامه و سپس Refactor
کردن آن است، به صورتی که نشانه‌های کد کثیف از بین بروند. به این نشانه‌ها [Code Smell](https://en.wikipedia.org/wiki/Code_smell)
می‌گوییم. در این مرحله در مورد Code Smellهای زیر مطالعه کنید و به این فکر کنید که کدام یک از موارد زیر، در کدی که برای پروژه جستجو زده‌اید به وجود آمده است؟ (این موارد را لیست‌وار در ایشو‌ی خود نام ببرید)

-   [Long Method](https://refactoring.guru/smells/long-method)
-   [Large Class](https://refactoring.guru/smells/large-class)
-   [Primitive Obsession](https://refactoring.guru/smells/primitive-obsession)
-   [Long Parameter List](https://refactoring.guru/smells/long-parameter-list)
-   [Temporary Field](https://refactoring.guru/smells/temporary-field)
-   [Duplicate Code](https://refactoring.guru/smells/duplicate-code)

## اصول S.O.L.I.D

تا به حال، به بررسی مواردی پرداختیم که صرفا به کوچک و بزرگی توابع و کلاس‌ها، عدم استفاده از کد تکراری و مسائل سطحی در تمیزی کد اشاره می‌کردند. اما یکی از مهم‌ترین نکات در کدنویسی تمیز، داشتن یک معماری تمیز است!

تصور کنید بخواهید پروژه‌تان را بزرگ‌ و بزرگ‌تر کنید و قابلیت‌های متعدد دیگری را به آن اضافه کنید. امروز ممکن است بخواهید خروجی برنامه را در کنسول، و روز دیگر ممکن است بخواهید آن را در وبسایت مشاهده کنید. نکته بسیار مهم آنکه نیاز‌مندی‌های پروژه‌ها و قابلیت‌هایی که دارند، در طول زمان دچار تغییر می‌شوند و باید دوباره به کد اصلی مراجعه کنیم و امکانات آن را بیشتر و بهتر کنیم. اما اگر معماری ما تمیز نباشد، این کار بسیار پرهزینه خواهد بود، به طوریکه شاید هزینه از اول نوشتن و ساختن آن پروژه کمتر باشد.

اصول پنج‌گانه SOLID یکی از **مهم‌ترین** مجموعه اصول مهندسی نرم‌افزار است که به ما در طراحی و معماری صحیح‌تر یک سیستم کمک می‌کند. به گونه‌ای که ایجاد تغییر و افزودن امکانات بیشتر به پروژه، سریع‌تر و راحت‌تر انجام شود. این اصول عبارت‌اند از:

1. **S**ingle Responsibility
1. **O**pen for Extension/Closed for Modification
1. **L**iskov Substitution
1. **I**nterface Segregation
1. **D**ependency Inversion

برای آشنایی با اصول SOLID لینک‌های زیر را مطالعه کنید:

-   [SOLID Principles in Java Application Development](https://www.jrebel.com/blog/solid-principles-in-java)
-   [S.O.L.I.D principles in Java](https://medium.com/@karthikcsridhar/s-o-l-i-d-principles-in-java-1aaff453d7ea)

:::tip‌
برای مطالعه بیشتر می‌توانید[A Solid Guide to SOLID Principles](https://www.baeldung.com/solid-principles)
را مطالعه کنید. همچنین توصیه می‌شود در صورت نیاز، هر یک از اصل‌ها را به طور مجزا مطالعه نموده تا مفهوم آن را به طور عمیقی درک کنید.
:::

## Refactoring Techniques

ما همواره با کد‌های تمیز سر و کار نداریم و اغلب لازم است، قسمت‌هایی از کد را بهبود دهیم تا کثیفی آن از بین برود. به این کار، refactor کردن کد می‌گویند.

برای این منظور، بعضا روش‌های خلاقانه‌ای وجود دارد که با بهره‌گیری از اصولی که پیش از این بیان شد، راهکار‌هایی برای بازنویسی کد ارائه می‌دهند. برای مشاهده انواع این شیوه‌ها می‌توانید به مجموعه [Refactoring Techniques](https://refactoring.guru/refactoring/techniques)
مراجعه کنید.

:::note ‌
مطالعۀ دقیق تمام موارد موجود در لینک مذکور **نیاز نیست** همین که به فهرست آن نگاه کنید و بعضی از آن‌ها را مرور کنید کافیست.
:::

## جستجوی کثیف!

هم‌اکنون که مفاهیم مختلف مربوط به کد تمیز را یاد گرفته‌اید، احتمالا ایده‌های زیادی برای بهبود سرویس جستجویی که در فاز قبل پیاده کرده‌اید به ذهنتان رسیده است.

اینکه چطور از اصول solid استفاده کنیم،
چه code smell هایی در کدمان وجود دارد،
و اینکه چطور می‌توان معماری برنامه را به گونه‌آی طراحی کرد تا توسعه قابلیت‌ روی آن ساده‌تر شود.

به عنوان پروژه این بخش می‌خواهیم به سراغ پروژه جستجوی فاز قبل رفته و آن را تمیز کنیم. اما این بار با این فرض که می‌خواهیم، موتور جستجوی خودمان را در قالب یک کتابخانه به دنیا معرفی کنیم، یا به طور ساده‌تر، در گیت‌هاب به عنوان یک ابزار آن را ارائه کنیم.

در این صورت لازم است کتابخانه ما انعطاف مناسبی را در اختیار برنامه‌نویسانی که از آن استفاده می‌کند قرار بدهد، تا در صورت نیاز، آن فرد بتواند استفاده‌های خاص‌منظوره خودش را نیز با کتابخانه ما برطرف کند. با این نگاه، لازم است نکات زیر را مد نظر قرار دهید و ببینید چگونه می‌توانید آن‌ها را برطرف کنید.

* با مفهوم normalization در فاز قبل آشنا شدیم. تصور کنید بسته به نیاز، یک فرد بخواهد از روش خاصی برای این کار استفاده کند؛ مثلا بخواهد همه نقطه‌ها و علائم نگارشی را حذف کند.

* به عنوان یک گام مهم در ساخت inverted index، از مفهوم tokenizer استفاده کردیم تا کلمات را بر حسب ` ` (`space`) از هم جدا کنیم. اما اگر فردی بخواهد بر اساس معیار‌های خودش (مثلا بر حسب `،` (ویرگول) این کار را بکند) چطور؟

:::note
امکاناتی که در این فاز و فاز‌های بعد ذکر می‌شوند، مسیر جالبی را طی خواهند کرد تا در نهایت شما را به یک نسخه ساده‌شده از یکی از بزرگترین پروژه‌های متن‌باز دنیا در زمینه جستجو برسانند! شما هم می‌توانید مشابه ساده‌شده این سرویس را پیاده‌سازی کرده و آن را با امکاناتی که خودتان طراحی کرده‌اید در دسترس برنامه‌نویسان جهان قرار دهید!
:::

## Code Review

بخش مهمی از یادگیری اصول کد‌نویسی تمیز، هنگام بررسی کد‌های دیگران و یافتن نقاط قوت و ضعف آن‌ها ایجاد می‌شود. همچنین با این کار، شما روش‌های مختلف حل مسئله را توسط تیم‌های دیگر خواهید داد و می‌توانید از آن‌ها ایده بگیرید.
 
 در این قسمت، ابتدا یک Pull Request ایجاد کنید و از یک تیم دیگر بخواهید Pull Request شما که در مرحله‌ی قبل ساخته‌اید را Review کنند و بر اساس لیست Code Smellها به شما بازخورد بدهند (روی Pull Request کامنت بگذارند)، در این مرحله حتما از تیم‌های دیگر هم سراغ شما می‌آیند و می‌خواهند کدشان را Review کنید، قبل از Review کد دیگران، راهنماهای زیر را مطالعه کنید و Review خود را بر اساس این راهنماها انجام دهید:

-   [What to look for in a code review](https://google.github.io/eng-practices/review/reviewer/looking-for.html)
-   [Effective Code Reviews: Code Review Checklist](https://github.com/nyu-cds/effective-code-reviews/blob/master/_episodes/03-checklist.md)

:::note ‌
با توجه به این که در این فاز صحبتی در مورد انواع تست به خصوص Unit Test نکردیم قسمت‌هایی از لینک‌های بالا که در مورد تست است را نادیده بگیرید.
:::

## مطالعه بیشتر:

در این فاز تلاش کردیم تا با اصلی‌ترین اصول کد‌نویسی تمیز آشنا شویم، اما طبیعی است، جزییات و نکات بسیار زیادی در این زمینه وجود دارد، به طوریکه کتاب معروف [clean code](https://github.com/JuanCrg90/Clean-Code-Notes)، به همین منظور نوشته شده است. پیشنهاد می‌شود برای یادگیری بیشتر، خلاصه کتاب clean code را مطالعه کنید. 

